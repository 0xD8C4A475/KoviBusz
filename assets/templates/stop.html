<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta author="Mefi <mefi@mefi.be>"/>
        <title>KöviBusz - Mefi-féle gyorsmenetrend a BKK {{ route }} jelzésű járatához</title>

        <link rel="stylesheet" href="/css/stop.css" />
        <link rel="shortcut icon" href="/images/favicon.png" type="image/gif" title="favicon rulezz" />
        <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
        <script>
            var setColorAndTextOrReload = function () {
                var now = Math.round(new Date().getTime() / 1000),
                        timestamp = Math.round($("#timestamp").data("timestamp") / 1000),
                        diff = (timestamp - now),
                        text,
                        time;

                if (0 > diff) {
                    window.location.reload();
                    clearInterval(intervalId);
                    return;
                }

                if (120 >= diff) {
                    $("#time").addClass("red").removeClass("green");
                }

                if (now % 10 === 0) {
                    text = "";
                    time = $("#timestamp").data("time");
                }
                else if (60 < diff) {
                    text = " perc";
                    time = Math.round(diff/60);
                } else {
                    text = " mp";
                    time = Math.round(diff);
                }

                $("#timestamp").text(time + " " + text);
            };
            $(function () {
                var intervalId = setInterval(setColorAndTextOrReload, 1000);
            });
        </script>
    </head>
    <body>
        <div id="container">
            <div id="route" class="{{ type }}">
                <p>{{ route }}</p>
            </div>
            <div id="time" class="green">
                <p id="timestamp" data-timestamp="{{ timestamp }}" data-time="{{ time }}">{{ time }}</p>
            </div>
        </div>
    </body>
</html>
